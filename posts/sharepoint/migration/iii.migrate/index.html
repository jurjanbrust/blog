<!DOCTYPE html>
<html lang="en-us">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Jurjan Brust - Migrating large corporate SharePoint intranets</title>
<meta name="description" content="Development">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="robots" content="all,follow">
<meta name="googlebot" content="index,follow,snippet,archive">
<link rel="stylesheet" href="https://jurjan.info/css/bootstrap.min.css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:400,300,700,400italic">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:100">
<link rel="stylesheet" href="https://jurjan.info/css/font-awesome.min.css">
<link rel="stylesheet" href="https://jurjan.info/css/owl.carousel.css">
<link rel="stylesheet" href="https://jurjan.info/css/owl.theme.css">


  <link href="https://jurjan.info/css/style.blue.css" rel="stylesheet" id="theme-stylesheet">

 

  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  


<link href="https://jurjan.info/css/custom.css" rel="stylesheet">
<link rel="shortcut icon" href="https://jurjan.info/img/favicon.png">



</head>
<body>
  <div id="all">
      <div class="container-fluid">
          <div class="row row-offcanvas row-offcanvas-left">
              <div id="sidebar" class="col-xs-6 col-sm-4 col-md-3 sidebar-offcanvas">
  <div class="sidebar-content">
    <a href="/"> <img src="/img/jurjan.png" class="avatar" /> </a>
    <h1 class="sidebar-heading"><a href="https://jurjan.info/">Jurjan Brust</a></h1>
    
      <p class="sidebar-p">SharePoint | O365 | Azure | IoT</p>
    
    <ul class="sidebar-menu">
      
        <li><a href="https://jurjan.info/posts/">HOME</a></li>
      
        <li><a href="https://jurjan.info/categories/azure">AZURE</a></li>
      
        <li><a href="https://jurjan.info/categories/sharepoint">SHAREPOINT / O365</a></li>
      
        <li><a href="https://jurjan.info/about/">ABOUT</a></li>
      
        <li><a href="https://jurjan.info/contact/">CONTACT</a></li>
      
    </ul>
    <p class="social">
  
  <a href="/index.xml" data-animate-hover="pulse" class="email">
    <i class="fa fa-rss"></i>
  </a>
  
  
  <a href="https://www.linkedin.com/in/jurjanbrust/" data-animate-hover="pulse" class="external">
    <i class="fa fa-linkedin"></i>
  </a>
  
  
  
  
  <a href="https://twitter.com/jurjanbrust" data-animate-hover="pulse" class="external twitter">
    <i class="fa fa-twitter"></i>
  </a>
  
  
  
  
  <a href="https://github.com/jurjanbrust" data-animate-hover="pulse" class="external">
    <i class="fa fa-github"></i>
  </a>
  
  
  
  
  <a href="mailto:mail@jurjan.info" data-animate-hover="pulse" class="email">
    <i class="fa fa-envelope"></i>
  </a>
  
</p>


    <div class="copyright">
      <p class="credit">
        
          &copy;2019 Jurjan Brust
        
        
      </p>
    </div>
  </div>
</div>

              
<div class="col-xs-12 col-sm-8 col-md-9 content-column white-background">
  <div class="small-navbar visible-xs">
  <button type="button" data-toggle="offcanvas" class="btn btn-ghost pull-left"> <i class="fa fa-align-left"> </i>Menu</button>
  <h1 class="small-navbar-heading"><a href="https://jurjan.info/">Jurjan Brust</a></h1>
</div>

  <div class="row">
    <div class="col-lg-8">
      <div class="content-column-content">
         <h1>Migrating large corporate SharePoint intranets</h1>
         <ul>
<li><input checked="" disabled="" type="checkbox"><a href="/posts/sharepoint/migration/i.approach/">Approach</a> (part I of IV)</li>
<li><input checked="" disabled="" type="checkbox"><a href="/posts/sharepoint/migration/ii.analysis">Analysis</a> (part II of IV)</li>
<li><input checked="" disabled="" type="checkbox"><a href="/posts/sharepoint/migration/iii.migrate">Migration</a> (part III of IV)</li>
<li><input disabled="" type="checkbox"><a href="/posts/sharepoint/migration/iv.verification">Verification</a> (part IV of IV)</li>
</ul>
<h2 id="migration">Migration</h2>
<p>In this third part of the series I will discuss the actual migration itself. If all previous steps were done right, the migration should be the easy part of the complete project.</p>
<h4 id="tool-selection">Tool selection</h4>
<p>I have found that for migrations to work almost autonomous only three tools are needed:</p>
<p>![](/img/III.Migrate/III.Migrate_2019-10-23-16-32-15.png# medium shadow rotate)</p>
<ol>
<li>Excel, and to be more specific a comma separated file (.csv) that is being used as an input file for the migration</li>
<li>PowerShell to script and automate the migration. Basically this consists of the following tasks:</li>
<li>Read input from .csv</li>
<li>[optional] do mutations / transformations on the input.csv (needed for a more specialised migration-scenario)</li>
<li>Use ShareGate PowerShell cmdlets</li>
<li>Process ShareGate logging</li>
<li>ShareGate, the migration tool that does the actual migration</li>
</ol>
<blockquote>
<p>In addition of using PowerShell to automate the migration, we have seen that PowerShell is also a great to to analyse your environment. When combining these, the output .csv of the analysis phase can serve as the input for the migration phase.</p>
</blockquote>
<h4 id="space-allocation">Space allocation</h4>
<p>Migrating to a new SharePoint environment (SharePoint online or SharePoint on-premise) will require storage and most likely lots it it. Make sure that the destination SharePoint farm is prepared to handle the amount of data. You can save some storage for on-premise migrations by turning down the SQL transaction logging. Also temporary disable SQL database mirroring can safe you from lots of unnecessary logging.</p>
<h4 id="migration-actions">Migration actions</h4>
<p>![](/img/III.Migrate/III.Migrate_2019-10-28-11-06-21.png# shadow)</p>
<p>Your migration process will look something like the image displayed above. See this as your base-migration plan that can be altered depending on your situation.
In general you do not want the users to be able to modify the source- site while the migration is in process. That means it is needed to remove these permissions before the migration starts. But since, most likely user permissions needs to be migrated too, the first step in this migration-plan is to export the user permissions.</p>
<p>Next step is the migration itself. The migration is done using PowerShell that processes a input.csv, uses ShareGate to migrate and handles the logging generated by ShareGate.
One rule I found to be very helpful is to log everything to file but only show critical events on the screen. The code-samples below contain such filtering mechanisms to display only the critical messages.</p>
<p>Finally when the migration has completed it is time to check the log and do some basic validations. Once this is done, permissions can be imported so that the environment becomes accessible for the users. Next communicate the migration results to the site owner and inform them about anything noticeable information or issues.</p>
<h4 id="migration-scenarios">Migration scenarios</h4>
<p>To describe the details of the migration itself we have to distinguish different scenarios. Each will be described in detail below.
As described before the migration is done using the ShareGate PowerShell cmdlets. The cmdlets to use depend on the type of migration that is needed.</p>
<p>I use the following table as a general guideline:</p>
<table>
<thead>
<tr>
<th>Migration type</th>
<th>ShareGate cmdlet</th>
</tr>
</thead>
<tbody>
<tr>
<td>site migration</td>
<td>Copy-Site</td>
</tr>
<tr>
<td>list migration</td>
<td>Copy-List</td>
</tr>
<tr>
<td>item migration</td>
<td>Copy-Content (not the list definition itself)</td>
</tr>
</tbody>
</table>
<h4 id="first-scenario-asis-migration">First scenario: as-is migration</h4>
<p>In this scenario no change is needed to the data and everything should be preserved as-is. One case I have used this is to &lsquo;archive&rsquo; project that are no longer in use on an on-premise environment and to store them in SharePoint Online for archive. Of course this scenario can also be used to migrate to SharePoint Online for projects that are still in use.</p>
<p>![](/img/III.Migrate/III.Migrate_2019-10-31-13-26-34.png# shadow)</p>
<blockquote>
<p>Input</p>
</blockquote>
<p>![](/img/III.Migrate/III.Migrate_2019-10-30-16-09-00.png# shadow)</p>
<p>The input consists of a simple .csv file that contains all of the source site URLs. Creating this input.csv can either be done manually or by using the analyse-script described in the: <a href="/posts/sharepoint/migration/ii.analysis">Analysis</a> (part II of IV) using recursion.</p>
<p>At the present time it has become a more common rule to use site collections instead of sites. When migrating from sites to site collections the Input csv can simply be extended to include a destination URL instead of using a single destination site URL as described below. Also notice that Sharegate can now also promote subsites to top-level sites as described in this article <a href="https://o365.tips/2019/promote-subsites-to-top-level-sites-with-sharegate-desktop-11-0/">O365.tips</a></p>
<blockquote>
<p>environment.ps1</p>
<p>These variables are used in the scripts below, it contains the name of the input file, a start index, end index and a destination site URL.
Making use of a start and end index it is possible to migrate only a segment of the complete input file. Migrating in smaller batches gives the opportunity to do some in-between migration validations. Another reason could be that sometimes the migration cannot continue in the evening because of security patches e.g.</p>
</blockquote>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->open raw file<!-- raw HTML omitted --></p>
<blockquote>
<p>0-show.ps1</p>
<p>Useful script to simply display the lines of the input file that will be migrated using the given $startIndex = 5 and $endIndex = 10.</p>
</blockquote>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->open raw file<!-- raw HTML omitted --></p>
<blockquote>
<p>1-migrate.ps1</p>
<p>The actual migration script. Basically just a plain PowerShell script, but makes use of the cmdlets provided by ShareGate such as: Connect-Site, New-MappingSettings, New-CopySettings and the Copy-Site. One rule I use is to log everything, but only display error and warning messages to the screen output. This way you do not get flooded by an information overload.</p>
</blockquote>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->open raw file<!-- raw HTML omitted --></p>
<p>Download the complete solution <a href="/files/sharepoint/migrate_sources/as-is/as-is.zip">here</a></p>
<h4 id="second-scenario-list-migrations-into-sites-based-on-custom-template">Second scenario: list migrations into sites based on custom template</h4>
<p>The second scenario I like to show is one where the destination site(s) are based on a custom developed / configured template. As described in the customizations part, there are situations in which it is better to develop a custom tailored template to fully suite the business case.
One method of developing such templates is by making use of the <a href="https://github.com/SharePoint/PnP">OfficeDev PnP</a>.</p>
<p>So when the site itself should not be copied but the content does you can choose to copy lists and list items only. In this example I will show you how to migrate lists, and I mean a lots of them.</p>
<p><img src="/img/III.Migrate/III.Migrate_2019-10-31-15-08-44.png" alt=""></p>
<p>In this migration we split-up the input files into two separate. One .csv that contains the relation between the source-sites an destination-sites. And a second file that contains the lists that need to be migrated. Note that once again this lists.csv is generated by the same PowerShell we used for analysis.</p>
<p>By opening this generated file that contains all the lists in all the website in Excel we can easily filter out the lists that should not be migrated.
Examples of lists that you may wish to exclude are:</p>
<ol>
<li>Web part gallery</li>
<li>Pages libraries</li>
<li>Tasks libraries</li>
<li>Libraries with no list items</li>
<li>Libraries based on a specific base-template</li>
<li>Libraries that have not been modified in the last year</li>
</ol>
<blockquote>
<p>environment.ps1</p>
<p>An updated environment, see the description above in previous scenario</p>
</blockquote>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->open raw file<!-- raw HTML omitted --></p>
<blockquote>
<p>Input (sites)  Note I do not display lists.csv because it is generated.</p>
</blockquote>
<p>![](/img/III.Migrate/III.Migrate_2019-10-31-15-29-05.png# shadow)</p>
<blockquote>
<p>0-show.ps1</p>
</blockquote>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->open raw file<!-- raw HTML omitted --></p>
<blockquote>
<p>0-validate.ps1</p>
<p>The validation script has been updated to also check if the source list still exists.</p>
</blockquote>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->open raw file<!-- raw HTML omitted --></p>
<blockquote>
<p>1-migrate-lists.ps1</p>
<p>And finally the migration script I use for list migrations</p>
</blockquote>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->open raw file<!-- raw HTML omitted --></p>
<p>Download the complete solution <a href="/files/sharepoint/migrate_sources/lists-only/lists-only.zip">here</a></p>
<h6 id="continue-reading-this-series-herepostssharepointmigrationivverification">Continue reading this series <a href="/posts/sharepoint/migration/iv.verification/">here</a></h6>
         
      </div>
    </div>
  </div>
</div>

          </div>
      </div>
  </div>
  <script src="https://jurjan.info/js/jquery.min.js"></script>
<script src="https://jurjan.info/js/bootstrap.min.js"></script>
<script src="https://jurjan.info/js/jquery.cookie.js"> </script>
<script src="https://jurjan.info/js/ekko-lightbox.js"></script>
<script src="https://jurjan.info/js/jquery.scrollTo.min.js"></script>
<script src="https://jurjan.info/js/masonry.pkgd.min.js"></script>
<script src="https://jurjan.info/js/imagesloaded.pkgd.min.js"></script>
<script src="https://jurjan.info/js/owl.carousel.min.js"></script>
<script src="https://jurjan.info/js/front.js"></script>



</body>
</html>
