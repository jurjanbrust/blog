<!DOCTYPE html>
<html lang="en-us">
<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>Jurjan Brust - Powershell security measures you should know about</title>
<meta name="description" content="jurjan.info">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="robots" content="all,follow">
<meta name="googlebot" content="index,follow,snippet,archive">
<meta property='og:title' content='Powershell security measures you should know about'/>
<meta property='og:image' content='https://jurjan.info/img/images/images_2019-10-21-15-57-22.png'/>
<meta property='og:description' content='jurjan.info'/>
<meta property='og:url' content='https://jurjan.info/posts/powershell/executionpolicy/'/>
<link rel="stylesheet" href="https://jurjan.info/css/bootstrap.min.css">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:400,300,700,400italic">
<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:100">
<link rel="stylesheet" href="https://jurjan.info/css/font-awesome.min.css">
<link rel="stylesheet" href="https://jurjan.info/css/owl.carousel.css">
<link rel="stylesheet" href="https://jurjan.info/css/owl.theme.css">


  <link href="https://jurjan.info/css/style.blue.css" rel="stylesheet" id="theme-stylesheet">

 

  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  


<link href="https://jurjan.info/css/custom.css" rel="stylesheet">
<link rel="shortcut icon" href="https://jurjan.info/img/favicon.png">


</head>
<body>
  <div id="all">
      <div class="container-fluid">
          <div class="row row-offcanvas row-offcanvas-left">
              <div id="sidebar" class="col-xs-6 col-sm-4 col-md-3 sidebar-offcanvas">
  <div class="sidebar-content">
    <a href="/"> <img src="/img/jurjan.png" class="avatar" /> </a>
    <h1 class="sidebar-heading"><a href="https://jurjan.info/">Jurjan Brust</a></h1>
    
      <p class="sidebar-p">SharePoint | O365 | Azure | IoT</p>
    
    <ul class="sidebar-menu">
      
        <li><a href="https://jurjan.info/posts/">HOME</a></li>
      
        <li><a href="https://jurjan.info/categories/projects">PROJECTS</a></li>
      
        <li><a href="https://jurjan.info/categories/azure">AZURE</a></li>
      
        <li><a href="https://jurjan.info/categories/sharepoint">SHAREPOINT / O365</a></li>
      
        <li><a href="https://jurjan.info/about/">ABOUT</a></li>
      
        <li><a href="https://jurjan.info/contact/">CONTACT</a></li>
      
    </ul>
    <p class="social">
  
  <a href="/index.xml" data-animate-hover="pulse" class="email">
    <i class="fa fa-rss"></i>
  </a>
  
  
  <a href="https://www.linkedin.com/in/jurjanbrust/" data-animate-hover="pulse" class="external">
    <i class="fa fa-linkedin"></i>
  </a>
  
  
  
  
  <a href="https://twitter.com/jurjanbrust" data-animate-hover="pulse" class="external twitter">
    <i class="fa fa-twitter"></i>
  </a>
  
  
  
  
  <a href="https://github.com/jurjanbrust" data-animate-hover="pulse" class="external">
    <i class="fa fa-github"></i>
  </a>
  
  
  
  
  <a href="mailto:mail@jurjan.info" data-animate-hover="pulse" class="email">
    <i class="fa fa-envelope"></i>
  </a>
  
</p>


    <div class="copyright">
      <p class="credit">
        
          &copy;2020 Jurjan Brust
        
        
      </p>
    </div>
  </div>
</div>

              
<div class="col-xs-12 col-sm-8 col-md-9 content-column white-background">
  <div class="small-navbar visible-xs">
  <button type="button" data-toggle="offcanvas" class="btn btn-ghost pull-left"> <i class="fa fa-align-left"> </i>Menu</button>
  <h1 class="small-navbar-heading"><a href="https://jurjan.info/">Jurjan Brust</a></h1>
</div>

  <div class="row">
    <div class="col-lg-8">
      <div class="content-column-content">
         <h1>Powershell security measures you should know about</h1>
         <p>I use PowerShell a lot to make life easier as a developer. Also for system administrators PowerShell can be a great solution for various tasks. There are little things that cannot be done using PowerShell when you would compare it to for example an executable file. Microsoft made some security measures to protect you from running any malicious PowerShell scripts and in this article I will summarise the information I found regarding this topic.</p>

<h3 id="file-cannot-be-loaded-because-of-execution-policies">File cannot be loaded because of Execution Policies</h3>

<p>When you are also working with PowerShell it will not take long until you will see an error message like displayed below. If this happens then I have some good news! you are well protected. ðŸ˜†
Seriously, PowerShell scripts should be treated as ordinary executable files and you would never run an executable that you grabbed from the internet without some serious doubts&hellip; now would you?</p>

<blockquote>
<p>.\GenerateListTestData.ps1 : File C:\Jurjan\Powershell\ListData\GenerateListTestData.ps1 cannot be loaded because
running scripts is disabled on this system. For more information, see about_Execution_Policies at</p>

<p><img src="/img/security/security_2020-02-04-12-11-02.png" alt="" /></p>
</blockquote>

<p>Now that we know that windows protects us from running potential harmful scripts, the most common question on the internet is: <strong>how can I avoid getting this security warning</strong> followed by the most common answer: <strong>set the execution policy to unrestricted</strong>.
Although it can be a solution to set the execution policy to unrestricted. Knowing what you are doing is better than just following this advice blindly.
Microsoft had described this policy here <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.security/set-executionpolicy?view=powershell-7">[click to open]</a> which you should read for a detailed understanding.</p>

<h2 id="scenario">Scenario</h2>

<p>In this scenario I download one of my own scripts, to do the same you can click the &lsquo;open raw button&rsquo; on the bottom of the page: <a href="/posts/sharepoint/powershell/generatelistdata/">generateListData</a>. I assure you, nothing bad will happen.</p>

<p>Now because I have not signed this file, you will probably also get a warning message as displayed below:</p>

<p><img src="/img/security/security_2020-02-04-11-40-04.png# extralarge shadow" alt="" /></p>

<p>Basically, this means, you downloaded a potentially harmful file because its origin is unknown.</p>

<p><img src="/img/security/security_2020-02-04-11-41-05.png# shadow" alt="" /></p>

<p>Now when you check the properties of the file, you will notice that the file has been blocked as a security measurement. Now lets see what happens if we will try to execute the PowerShell script.
First we need to check what the actual execution policy is set to on the computer. We can do this by using the following PowerShell command <code>Get-ExecutionPolicy</code>:</p>

<p><img src="/img/security/security_2020-02-04-16-34-37.png" alt="" /></p>

<p>And as you can see I have set it to Restricted. Restricted doesn&rsquo;t load configuration files or run scripts. This is the default execution policy for Windows client computers.</p>

<p><details>
  <summary>Click here to see all the options available</summary></p>

<pre><code>The acceptable execution policy values are as follows:

a) AllSigned. Requires that all scripts and configuration files are signed by a trusted publisher, including scripts written on the local computer.
b) Bypass. Nothing is blocked and there are no warnings or prompts.
c) Default. Sets the default execution policy. Restricted for Windows clients or RemoteSigned for Windows servers.
d) RemoteSigned. Requires that all scripts and configuration files downloaded from the Internet are signed by a trusted publisher. The default execution policy for Windows server computers.
e) Restricted. Doesn't load configuration files or run scripts. The default execution policy Windows client computers.
f) Undefined. No execution policy is set for the scope. Removes an assigned execution policy from a scope that is not set by a Group Policy. If the execution policy in all scopes is Undefined, the effective execution policy is Restricted.
g) Unrestricted. Beginning in PowerShell 6.0, this is the default execution policy for non-Windows computers and can't be changed. Loads all configuration files and runs all scripts. If you run an unsigned script that was downloaded from the internet, you're prompted for permission before it runs.
</code></pre>

<p></details></p>

<p>It should be no surprise that when I try to execute this script that I will get the error mentioned in the introduction.</p>

<blockquote>
<p><img src="/img/security/security_2020-02-04-12-11-02.png" alt="" /></p>
</blockquote>

<p>When we set the execution policy to unrestricted using <code>Set-ExecutionPolicy Unrestricted</code> and try to execute a blocked PowerShell we will see the following error message which got me quite puzzled until I now know that in such situations the file is blocked.</p>

<p><img src="/img/security/security_2020-02-04-16-43-36.png" alt="" /></p>

<p>Once we unblock the file, using the checkbox of the file properties, we can finally run the script without any warnings. Another way to unblock scripts is to use the <code>Unblock-File</code> cmdlet.</p>

<p>Finally, when the execution-policy is set to RemoteSigned any blocked file will get the error message (so not even the security-warning) and all unblocked files will be executed without any warnings.</p>

<h3 id="final-words">Final words</h3>

<p>When working with PowerShell scripts I would advice to set the execution-policy to RemoteSigned and never to Unrestricted. This way any unblocked file can be executed, while blocked files have to be unblocked first. Always open the script first to see what it does before executing.</p>
         
      </div>
    </div>
  </div>
</div>

          </div>
      </div>
  </div>
  <script src="https://jurjan.info/js/jquery.min.js"></script>
<script src="https://jurjan.info/js/bootstrap.min.js"></script>
<script src="https://jurjan.info/js/jquery.cookie.js"> </script>
<script src="https://jurjan.info/js/ekko-lightbox.js"></script>
<script src="https://jurjan.info/js/jquery.scrollTo.min.js"></script>
<script src="https://jurjan.info/js/masonry.pkgd.min.js"></script>
<script src="https://jurjan.info/js/imagesloaded.pkgd.min.js"></script>
<script src="https://jurjan.info/js/owl.carousel.min.js"></script>
<script src="https://jurjan.info/js/front.js"></script>



</body>
</html>
